# Contributing to Restaurant AR Platform | Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

<div dir="rtl">

Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ Ø¨Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø²! Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ù„Ø²Ù…Ø© ÙˆØ§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø§ØªØ¨Ø§Ø¹Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.

</div>

Thank you for your interest in contributing to the Restaurant AR Platform! This document contains mandatory rules and guidelines to follow when contributing to the project.

---

## ğŸ“‹ Table of Contents | Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

- [Mandatory Development Rules](#mandatory-development-rules--Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯-Ø§Ù„Ù…Ù„Ø²Ù…Ø©)
- [Code Standards](#code-standards--Ù…Ø¹Ø§ÙŠÙŠØ±-Ø§Ù„ÙƒÙˆØ¯)
- [Git Workflow](#git-workflow--Ø³ÙŠØ±-Ø§Ù„Ø¹Ù…Ù„-Ù…Ø¹-git)
- [Testing](#testing--Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±)
- [Pull Request Process](#pull-request-process--Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª-Ø·Ù„Ø¨-Ø§Ù„Ø¯Ù…Ø¬)

---

## ğŸš¨ Mandatory Development Rules | Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ù„Ø²Ù…Ø©

<div dir="rtl">

### Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©

Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ **Ø¥Ù„Ø²Ø§Ù…ÙŠØ©** ÙˆÙŠØ¬Ø¨ Ø§ØªØ¨Ø§Ø¹Ù‡Ø§ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª:

</div>

These rules are **MANDATORY** and must be followed at all times:

### 1ï¸âƒ£ Snapshot-First Rule | Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù€ Snapshot Ø£ÙˆÙ„Ø§Ù‹

<div dir="rtl">

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**: Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ­ÙØ¸ ÙƒÙ€ snapshot ÙƒØ§Ù…Ù„ ÙÙŠ ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨.

**Ø§Ù„Ø³Ø¨Ø¨**:

- Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø¯ ØªØªØºÙŠØ±
- Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‚Ø¯ ØªÙØ­Ø°Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹ÙƒØ³ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨

</div>

**Rule**: All order items MUST be saved as a complete snapshot at order time.

**Reason**:

- Prices may change
- Items may be deleted from menu
- Historical orders must reflect exact state at order time

**Implementation**:

```typescript
// âœ… CORRECT - Full snapshot
const orderItem = {
  menuItemId: item.id,
  quantity: 2,
  price: item.price, // Current price
  itemSnapshot: {
    name: item.name,
    nameAr: item.nameAr,
    price: item.price,
    description: item.description,
    image: item.image,
    arModelUrl: item.arModelUrl,
    // ... all relevant fields
  },
};

// âŒ WRONG - Only reference
const orderItem = {
  menuItemId: item.id,
  quantity: 2,
};
```

---

### 2ï¸âƒ£ Backend is Source of Truth | Backend Ù‡Ùˆ Ù…ØµØ¯Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©

<div dir="rtl">

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**: Ø¬Ù…ÙŠØ¹ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ ÙŠØ¬Ø¨ Ø£Ù† ØªØªÙ… ÙÙŠ Backend APIØŒ ÙˆÙ„ÙŠØ³ ÙÙŠ Frontend.

**Ø§Ù„Ø³Ø¨Ø¨**:

- Ø§Ù„Ø£Ù…Ø§Ù†: Frontend ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ Ø¨Ù‡
- Ø§Ù„Ø§ØªØ³Ø§Ù‚: Ù…Ù†Ø·Ù‚ ÙˆØ§Ø­Ø¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
- Ø§Ù„ØµÙŠØ§Ù†Ø©: ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯

</div>

**Rule**: All business calculations and validation MUST happen in Backend API, not Frontend.

**Reason**:

- Security: Frontend can be manipulated
- Consistency: Single logic for all clients
- Maintenance: Change rules in one place

**Examples**:

```typescript
// âœ… CORRECT - Backend calculates
POST /api/orders
{
  items: [{ menuItemId: "123", quantity: 2 }],
  promotionCode: "SAVE20"
}

// Backend response with calculated totals
{
  subtotal: 100,
  discount: 20,
  tax: 12,
  total: 92
}

// âŒ WRONG - Frontend calculates and sends
POST /api/orders
{
  items: [...],
  subtotal: 100,
  discount: 20,
  tax: 12,
  total: 92  // Never trust these from frontend!
}
```

**What MUST be done in Backend**:

- Price calculations
- Discount applications
- Tax calculations
- Inventory checks
- Promotion validations
- Payment processing
- Order status changes

---

### 3ï¸âƒ£ No Business Logic in Next.js API Routes | Ù„Ø§ Ù…Ù†Ø·Ù‚ Ø£Ø¹Ù…Ø§Ù„ ÙÙŠ Next.js

<div dir="rtl">

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**: Next.js API Routes ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† thin proxies ÙÙ‚Ø· - ØªÙØ¹ÙŠØ¯ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¥Ù„Ù‰ NestJS API.

**Ø§Ù„Ø³Ø¨Ø¨**:

- ÙØµÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª
- Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯
- Backend ÙˆØ§Ø­Ø¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
- Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

</div>

**Rule**: Next.js API Routes MUST be thin proxies only - forward requests to NestJS API.

**Reason**:

- Separation of concerns
- Code reusability
- Single backend for all clients
- Easy testing

**Examples**:

```typescript
// âœ… CORRECT - Thin proxy
// apps/web/src/app/api/menu/route.ts
export async function GET() {
  const response = await fetch(`${API_URL}/menu`);
  const data = await response.json();
  return Response.json(data);
}

// âŒ WRONG - Business logic in Next.js
export async function GET() {
  const prisma = new PrismaClient();
  const items = await prisma.menuItem.findMany({
    where: { isAvailable: true },
    include: { category: true },
  });

  // âŒ Business logic here!
  const processedItems = items.map((item) => ({
    ...item,
    discountedPrice: item.price * 0.9,
  }));

  return Response.json(processedItems);
}
```

**What Next.js API Routes CAN do**:

- Forward requests to NestJS
- Handle authentication cookies
- Add request headers
- Format responses for frontend

**What Next.js API Routes CANNOT do**:

- Database queries
- Business calculations
- Validation logic
- Data transformations

---

### 4ï¸âƒ£ AR = Progressive Enhancement | AR ÙƒÙ…ÙŠØ²Ø© ØªØ­Ø³ÙŠÙ†ÙŠØ©

<div dir="rtl">

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**: AR ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ÙŠØ²Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©ØŒ ÙˆÙ„ÙŠØ³Øª Ù…ØªØ·Ù„Ø¨Ø§Ù‹ Ø£Ø³Ø§Ø³ÙŠØ§Ù‹.

**Ø§Ù„Ø³Ø¨Ø¨**:

- Ù„ÙŠØ³Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ØªØ¯Ø¹Ù… AR
- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù‚Ø¯ ÙŠÙØ¶Ù„ÙˆÙ† Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… AR
- Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† AR

</div>

**Rule**: AR MUST be an optional feature, not a core requirement.

**Reason**:

- Not all devices support AR
- Users may prefer not to use AR
- System must work without AR

**Implementation**:

```typescript
// âœ… CORRECT - AR as enhancement
interface MenuItem {
  id: string;
  name: string;
  price: number;
  image: string;           // Required
  hasArModel: boolean;      // Flag
  arModelUrl?: string;      // Optional
  arThumbnail?: string;     // Optional
}

// Component design
function MenuItemCard({ item }: Props) {
  return (
    <div>
      <img src={item.image} alt={item.name} />
      <h3>{item.name}</h3>
      <p>{item.price} SAR</p>

      {/* AR is optional enhancement */}
      {item.hasArModel && (
        <button>View in AR</button>
      )}
    </div>
  );
}

// âŒ WRONG - AR required
interface MenuItem {
  id: string;
  name: string;
  arModelUrl: string;  // Required - Wrong!
}
```

**Guidelines**:

- Always provide fallback images
- Make AR features discoverable but not intrusive
- Track AR usage in analytics
- Handle AR errors gracefully
- Test all features without AR enabled

---

## ğŸ’» Code Standards | Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯

### TypeScript

- Use strict TypeScript
- No `any` types (use `unknown` if needed)
- Define proper interfaces/types
- Export types from shared package

### Naming Conventions

```typescript
// Files
menu-item.dto.ts          // Kebab-case for files
MenuItemService.ts        // PascalCase for classes

// Variables & Functions
const menuItems = [];     // camelCase
function getMenuItem() {} // camelCase

// Types & Interfaces
interface MenuItem {}     // PascalCase
type OrderStatus = ...;   // PascalCase

// Constants
const MAX_ORDER_ITEMS = 50; // UPPER_SNAKE_CASE
```

### Code Organization

```typescript
// âœ… CORRECT - Organized imports
// 1. External dependencies
import { Injectable } from '@nestjs/common';
import { PrismaClient } from '@prisma/client';

// 2. Internal packages
import { CreateOrderInput } from '@restaurant/shared';

// 3. Relative imports
import { OrderService } from './order.service';
```

### Error Handling

```typescript
// âœ… CORRECT - Use error codes from shared package
import { ERROR_CODES, getErrorMessage } from '@restaurant/shared';

throw new NotFoundException({
  code: ERROR_CODES.MENU_ITEM_NOT_FOUND.code,
  message: getErrorMessage('MENU_ITEM_NOT_FOUND', 'ar'),
});

// âŒ WRONG - Hardcoded messages
throw new NotFoundException('Menu item not found');
```

---

## ğŸ”„ Git Workflow | Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ù…Ø¹ Git

### Branch Naming

```bash
feature/ar-menu-viewer     # New feature
fix/order-calculation      # Bug fix
docs/api-documentation     # Documentation
refactor/menu-service      # Code refactoring
```

### Commit Messages

Follow conventional commits:

```bash
feat: add AR model viewer component
fix: correct order total calculation
docs: update API documentation
refactor: simplify menu item query
test: add order service tests
chore: update dependencies
```

Arabic commits are also acceptable:

```bash
feat: Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ø±Ø¶ Ù†Ù…Ø§Ø°Ø¬ AR
fix: ØªØµØ­ÙŠØ­ Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨
```

---

## ğŸ§ª Testing | Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

### Before Submitting PR

```bash
# 1. Lint code
pnpm lint

# 2. Type check
pnpm type-check

# 3. Format code
pnpm format

# 4. Build all apps
pnpm build

# 5. Run tests (when available)
pnpm test
```

### Testing Checklist

- [ ] Code builds without errors
- [ ] All linting rules pass
- [ ] TypeScript has no errors
- [ ] Manual testing completed
- [ ] Database migrations work
- [ ] No sensitive data committed

---

## ğŸ“ Pull Request Process | Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø·Ù„Ø¨ Ø§Ù„Ø¯Ù…Ø¬

### PR Checklist

Before submitting a PR:

- [ ] Code follows all 4 mandatory rules
- [ ] Code passes all checks (lint, type-check, build)
- [ ] Branch is up to date with main
- [ ] Commit messages are clear
- [ ] PR description explains changes
- [ ] Screenshots added for UI changes
- [ ] Database changes documented
- [ ] No breaking changes (or documented)

### PR Template

```markdown
## Description | Ø§Ù„ÙˆØµÙ

Brief description of changes in English and Arabic.

## Type of Change | Ù†ÙˆØ¹ Ø§Ù„ØªØºÙŠÙŠØ±

- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update

## Mandatory Rules Compliance | Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ù„Ø²Ù…Ø©

- [ ] Snapshot-First Rule followed
- [ ] All business logic in Backend
- [ ] No business logic in Next.js API Routes
- [ ] AR as progressive enhancement

## Testing | Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

- [ ] Lint passed
- [ ] Type check passed
- [ ] Build successful
- [ ] Manual testing completed

## Screenshots | Ù„Ù‚Ø·Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©

(If applicable)
```

---

## ğŸš« Common Mistakes to Avoid | Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø© ÙŠØ¬Ø¨ ØªØ¬Ù†Ø¨Ù‡Ø§

### âŒ DON'T

```typescript
// 1. Don't store only IDs
const orderItem = { menuItemId: "123" };

// 2. Don't calculate prices in frontend
const total = items.reduce((sum, item) => sum + item.price, 0);
submitOrder({ items, total });

// 3. Don't put business logic in Next.js
export async function POST(req: Request) {
  const prisma = new PrismaClient();
  // Database queries here âŒ
}

// 4. Don't make AR required
<MenuItem arModel={item.arModel} /> // Crashes if no AR

// 5. Don't hardcode error messages
throw new Error('Item not found');
```

### âœ… DO

```typescript
// 1. Store complete snapshots
const orderItem = {
  menuItemId: "123",
  itemSnapshot: { /* full item data */ }
};

// 2. Let backend calculate
const response = await fetch('/api/orders', {
  method: 'POST',
  body: JSON.stringify({ items }) // Backend calculates total
});

// 3. Use thin proxies in Next.js
export async function POST(req: Request) {
  return fetch(`${API_URL}/orders`, { /* forward */ });
}

// 4. Make AR optional
{item.hasArModel && <ArViewer model={item.arModel} />}

// 5. Use error codes
import { ERROR_CODES } from '@restaurant/shared';
throw new NotFoundException(ERROR_CODES.MENU_ITEM_NOT_FOUND);
```

---

## ğŸ“š Additional Resources | Ù…ØµØ§Ø¯Ø± Ø¥Ø¶Ø§ÙÙŠØ©

- [Architecture Documentation](./docs/architecture/)
- [API Documentation](./docs/api/)
- [Database Schema](./packages/database/prisma/schema.prisma)
- [Shared Types](./packages/shared/src/)

---

## ğŸ¤ Questions? | Ø£Ø³Ø¦Ù„Ø©ØŸ

If you have questions about these rules:

1. Open an issue with the `question` label
2. Ask in discussions
3. Review existing PRs for examples

---

<div align="center">

**Thank you for contributing! | Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø³Ø§Ù‡Ù…ØªÙƒ!**

</div>
